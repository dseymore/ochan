<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jaxws="http://cxf.apache.org/jaxws"
	xmlns:http-conf="http://cxf.apache.org/transports/http/configuration" xmlns:jaxrs="http://cxf.apache.org/jaxrs" xmlns:a="http://abdera.apache.org"
	xsi:schemaLocation="
http://cxf.apache.org/transports/http/configuration http://cxf.apache.org/schemas/configuration/http-conf.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd
http://abdera.apache.org http://abdera.apache.org/schemas/abdera-spring.xsd">
	<import resource="classpath:META-INF/cxf/cxf.xml" />
	<import resource="classpath:META-INF/cxf/cxf-extension-soap.xml" />
	<import resource="classpath:META-INF/cxf/cxf-servlet.xml" />
	<import resource="service-beans.xml" />
	<import resource="classpath:META-INF/cxf/cxf-extension-xml.xml" />
	<import resource="classpath:META-INF/cxf/cxf-extension-jaxrs-binding.xml" />



	<!--  category Service -->
	<bean id="categoryListBean" class="org.ochan.service.remote.webservice.CategoryListImpl">
		<property name="categoryService" ref="localCategoryService" />
	</bean>
	<jaxws:endpoint id="CategoryList" implementor="#categoryListBean" address="/category" />

	<!--  category client  -->
<!--	I would love to use spring to build me a client.. but..problem is.. we dont know the url, and the client comes configured-->
<!--	<bean id="client" class="org.ochan.service.remote.webservice.CategoryList"-->
<!--		factory-bean="clientFactory" factory-method="create" />-->
<!---->
	<bean id="clientFactory" class="org.apache.cxf.jaxws.JaxWsProxyFactoryBean">
		<property name="serviceClass" value="org.ochan.service.remote.webservice.CategoryList" />
		<property name="address" value="http://localhost:8080/remote/category" />
	</bean>
	
	<!--  our JMX interaction guy  -->
	<bean id="hostlist" class="org.ochan.service.remote.jmx.HostList">
		<property name="categoryListClient" ref="clientFactory" />
		<property name="externalCategoryService" ref="localExternalCategoryService" />
	</bean>
	<http-conf:conduit name="*.http-conduit">
		<http-conf:client AllowChunking="false" />
	</http-conf:conduit>
	


	<!--  Post Service -->
	<!--  no client ATM -->
	<bean id="postListBean" class="org.ochan.service.remote.webservice.PostListImpl">
		<property name="postService" ref="localPostService" />
		<property name="threadService" ref="localThreadService" />
	</bean>
	<!--  Thread Support Service -->
	<!--  no client ATM -->
	<bean id="threadSupportBean" class="org.ochan.service.remote.webservice.ThreadSupportImpl">
		<property name="threadService" ref="localThreadService" />
		<property name="postService" ref="localPostService" />
	</bean>
	<!-- Statistics Service -->
	<bean id="statsBean" class="org.ochan.service.remote.webservice.InstanceStatisticsImpl"/>
	<!--  rest service endpoint -->
	<jaxrs:server id="restEndpoint" address="/rest/">
		<jaxrs:serviceBeans>
	    	<ref bean="postListBean" />
	    	<ref bean="threadSupportBean"/>
	    	<ref bean="statsBean"/>
	    </jaxrs:serviceBeans>
	</jaxrs:server>
	
	
	
	
	<!--  Atom Feeds -->
	<bean id="threadCollectionAdapter" class="org.ochan.atom.ThreadCollectionAdapter">
<!-- setting the href here doesn't work.. it gets encoded.. which is fail. -->
<!--		<property name="href" value="threads"/>-->
		<property name="postService" ref="localPostService" />
		<property name="threadService" ref="localThreadService"/>
		<property name="categoryService" ref="localCategoryService"/>
		<property name="cache" ref="threadCache"/>
	</bean>
	<!--  TODO - add threadservice -->
	<!-- Abdera -->
	<a:provider>
		<property name="workspaces">
			<ref bean="simpleWorkspace" />
		</property>
		<a:targetResolver>
			<a:regexTargetResolver>
				<a:collection>(.*)threads(.*)</a:collection>
				<a:entry>/atom/feed/([^/#?]+)(\?[^#]*)?</a:entry>
				<a:service>/atom(\?[^#]*)?</a:service>
			</a:regexTargetResolver>
		</a:targetResolver>
	</a:provider>
	<bean id="simpleWorkspace" class="org.apache.abdera.protocol.server.impl.SimpleWorkspaceInfo">
		<property name="title" value="Ochan Workspace" />
		<property name="collections">
			<list>
				<ref bean="threadCollectionAdapter" />
			</list>
		</property>
	</bean>
</beans>